<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Learning Plan Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    :root {
        --bg: #f4f6fb;
        --card-bg: #ffffff;
        --border: #d7deeb;
        --text: #20334f;
        --muted: #6b7a99;
        --accent: #3b6ef5;
        --wah-accent: #1f8a5f;
        --warning: #c0392b;
        --badge-bg: #e6ecff;
        --badge-text: #1c3d8f;
    }
    * {
        box-sizing: border-box;
    }
    body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, sans-serif;
        background: var(--bg);
        color: var(--text);
    }
    .app {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem 4rem;
    }
    header {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        align-items: flex-end;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    header h1 {
        margin: 0;
        font-size: clamp(1.6rem, 3vw, 2.1rem);
        letter-spacing: -0.5px;
    }
    header p {
        margin: 0;
        color: var(--muted);
    }
    .summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }
    .summary-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        box-shadow: 0 6px 12px rgba(32, 51, 79, 0.05);
    }
    .summary-card h2 {
        margin: 0;
        font-size: 0.9rem;
        text-transform: uppercase;
        color: var(--muted);
        letter-spacing: 0.08em;
    }
    .summary-card .value {
        display: block;
        font-size: 1.8rem;
        font-weight: 700;
        margin-top: 0.25rem;
    }
    .summary-card small {
        display: block;
        margin-top: 0.5rem;
        color: var(--muted);
        line-height: 1.4;
    }
    .subject-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
        margin-top: 0.75rem;
    }
    .subject-tag {
        background: #eaf0ff;
        color: #1f3d80;
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
        font-size: 0.75rem;
        line-height: 1;
        border: 1px solid rgba(31, 61, 128, 0.15);
    }

    .controls {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 6px 12px rgba(32, 51, 79, 0.05);
        display: grid;
        gap: 1rem;
    }
    .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
    }
    .filter-row label {
        font-weight: 600;
        color: var(--muted);
        font-size: 0.9rem;
    }
    .filter-row .grow {
        flex: 1 1 220px;
    }
    .search-input {
        width: 100%;
        padding: 0.65rem 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--border);
        font-size: 0.95rem;
        transition: border 0.2s, box-shadow 0.2s;
    }
    .search-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(59, 110, 245, 0.12);
    }
    .toggle-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem 1rem;
    }
    .toggle {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.9rem;
        color: var(--muted);
    }
    .toggle input {
        width: 16px;
        height: 16px;
    }

    .subject-filter-group {
        border-top: 1px dashed var(--border);
        margin-top: 0.25rem;
        padding-top: 0.75rem;
    }
    .subject-filter-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }
    .subject-checkboxes {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.5rem 1rem;
    }
    .subject-checkboxes label {
        display: flex;
        gap: 0.4rem;
        font-size: 0.9rem;
        color: var(--muted);
        cursor: pointer;
        align-items: flex-start;
    }
    .subject-checkboxes input {
        margin-top: 0.2rem;
    }
    .subject-filter-actions button,
    .actions button {
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 999px;
        padding: 0.55rem 1.1rem;
        font-size: 0.9rem;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .subject-filter-actions button.secondary,
    .actions button.secondary {
        background: #eff2ff;
        color: #1f3d80;
    }
    .subject-filter-actions button:hover,
    .actions button:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 14px rgba(59, 110, 245, 0.2);
    }
    .actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .status-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem 1.25rem;
        align-items: center;
        margin-bottom: 1rem;
        color: var(--muted);
        font-size: 0.9rem;
    }
    .status-bar strong {
        color: var(--text);
    }

    details.day-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        margin-bottom: 1rem;
        overflow: hidden;
        box-shadow: 0 10px 18px rgba(32, 51, 79, 0.08);
    }
    details.day-card[open] {
        border-color: rgba(59, 110, 245, 0.35);
    }
    details.day-card summary {
        list-style: none;
        padding: 1rem 1.25rem;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        background: linear-gradient(90deg, #f6f8ff 0%, #ffffff 100%);
    }
    details.day-card summary::-webkit-details-marker {
        display: none;
    }
    .summary-left {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
    }
    .day-title {
        font-size: 1.05rem;
        font-weight: 600;
    }
    .badge-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
    }
    .badge {
        font-size: 0.75rem;
        padding: 0.3rem 0.6rem;
        border-radius: 999px;
        border: 1px solid transparent;
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }
    .badge.lesson {
        background: #eaf0ff;
        color: #1f3d80;
        border-color: rgba(31, 61, 128, 0.2);
    }
    .badge.wah {
        background: #e2f5ec;
        color: var(--wah-accent);
        border-color: rgba(31, 138, 95, 0.25);
    }
    .badge.warning {
        background: #ffe8e5;
        color: var(--warning);
        border-color: rgba(192, 57, 43, 0.25);
    }
    .summary-right {
        color: var(--muted);
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .day-content {
        padding: 1.25rem;
        border-top: 1px solid var(--border);
        background: #fff;
    }
    .view-toggle {
        display: inline-flex;
        border: 1px solid var(--border);
        border-radius: 999px;
        overflow: hidden;
        margin-bottom: 1rem;
    }
    .view-toggle button {
        background: transparent;
        border: none;
        padding: 0.4rem 0.9rem;
        font-size: 0.85rem;
        cursor: pointer;
        color: var(--muted);
        transition: background 0.2s, color 0.2s;
    }
    .view-toggle button.active {
        background: var(--accent);
        color: #fff;
    }
    .view-toggle button:not(:last-child) {
        border-right: 1px solid var(--border);
    }

    .structured-view.hidden,
    .raw-view.hidden {
        display: none;
    }
    .subject-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }
    .subject-card {
        border: 1px solid #e0e6f5;
        border-radius: 10px;
        padding: 0.85rem;
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        background: #fdfdff;
    }
    .subject-title {
        font-size: 0.95rem;
        font-weight: 600;
        display: flex;
        gap: 0.5rem;
        align-items: center;
        color: var(--text);
    }
    .subject-section {
        border-radius: 8px;
        padding: 0.6rem 0.65rem;
        background: #fff;
        border: 1px solid rgba(32, 51, 79, 0.08);
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
    }
    .subject-section .section-title {
        font-size: 0.75rem;
        letter-spacing: 0.06em;
        color: var(--muted);
        text-transform: uppercase;
    }
    .subject-section .section-body {
        font-size: 0.9rem;
        line-height: 1.4;
        color: var(--text);
    }
    .subject-section.wah-section {
        border-left: 4px solid var(--wah-accent);
        background: #f2fcf6;
    }
    .subject-section.has-no-lesson .section-body {
        background: #ffeceb;
        color: var(--warning);
        border-radius: 6px;
        padding: 0.35rem 0.4rem;
        font-weight: 600;
    }

    table.raw-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
    }
    table.raw-table th,
    table.raw-table td {
        border: 1px solid #e0e6f5;
        padding: 0.6rem;
        text-align: left;
        vertical-align: top;
    }
    table.raw-table th {
        background: #f6f8ff;
        color: #1c3d8f;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
    }
    table.raw-table td {
        background: #fff;
    }
    table.raw-table td.no-lesson {
        background: #ffeceb;
        color: var(--warning);
        font-weight: 600;
    }

    .empty-state {
        display: none;
        text-align: center;
        padding: 2.5rem 1rem;
        color: var(--muted);
        background: transparent;
        border: 2px dashed var(--border);
        border-radius: 12px;
    }

    @media (max-width: 768px) {
        .subject-checkboxes {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
        details.day-card summary {
            flex-direction: column;
            align-items: flex-start;
        }
        .summary-right {
            align-self: flex-end;
        }
    }
    @media (max-width: 520px) {
        header {
            align-items: flex-start;
        }
        .subject-grid {
            grid-template-columns: 1fr;
        }
        .subject-checkboxes {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }
        .search-input {
            font-size: 1rem;
        }
    }
</style>
</head>
<body>
<div class="app">
    <header>
        <div>
            <h1>Day-wise &amp; Subject-wise Learning Plan</h1>
            <p>Interactive view of lesson plans and work-at-home tasks extracted from Excel rows.</p>
        </div>
    </header>

    <section class="summary">
        <div class="summary-card">
            <h2>Days Loaded</h2>
            <span class="value" id="totalDays">0</span>
            <small>Unique calendar days represented in the data.</small>
        </div>
        <div class="summary-card">
            <h2>Subjects Detected</h2>
            <span class="value" id="totalSubjects">0</span>
            <small>Distinct subject columns found across all rows.</small>
            <div class="subject-tags" id="subjectTagList"></div>
        </div>
        <div class="summary-card">
            <h2>Currently Showing</h2>
            <span class="value"><span id="visibleCount">0</span> / <span id="totalCount">0</span></span>
            <small>Matching days after applying filters.</small>
        </div>
    </section>

    <section class="controls">
        <div class="filter-row">
            <label for="searchInput">Search plan</label>
            <div class="grow">
                <input id="searchInput" class="search-input" type="search" placeholder="Search by date, subject, or any text…">
            </div>
        </div>
        <div class="filter-row toggle-group">
            <label class="toggle"><input type="checkbox" id="filterLesson"> Show only days with Lesson Plan entries</label>
            <label class="toggle"><input type="checkbox" id="filterWah"> Show only days with WAH entries</label>
        </div>
        <div class="subject-filter-group">
            <div class="subject-filter-header">
                <strong style="font-size:0.95rem;color:var(--text);">Filter by subjects</strong>
                <div class="subject-filter-actions">
                    <button type="button" class="secondary" id="clearSubjects">Clear selection</button>
                </div>
            </div>
            <div class="subject-checkboxes" id="subjectFilters"></div>
        </div>
        <div class="actions">
            <button type="button" id="expandAll">Expand all</button>
            <button type="button" class="secondary" id="collapseAll">Collapse all</button>
        </div>
    </section>

    <div class="status-bar">
        <span><strong>Tip:</strong> Use the “Raw Data” view inside each day to inspect the original Excel rows.</span>
    </div>

    <div id="daysContainer"></div>
    <div class="empty-state" id="emptyState">No days match the current filters or search term. Adjust the filters to see results.</div>
</div>

<script>
const data = /* I will paste data here */ {"Thu, 12 Feb":{"lesson_plan":{"row_number":16,"Date":"Thu, 12 Feb","Component":"Lesson Plan","Morning Circle / HR":"Experience of playing - sharing by students","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme : Light\nResource : Science Textbook\n\nWU: \nML: \nPW: ","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":17,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Wed, 11 Feb":{"lesson_plan":{"row_number":18,"Date":"Wed, 11 Feb","Component":"Lesson Plan","Morning Circle / HR":"Experience of playing - sharing by students","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme : Light\nResource : Science Textbook\n\nWU: \nML: \nPW: ","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":19,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Tue, 10 Feb":{"lesson_plan":{"row_number":20,"Date":"Tue, 10 Feb","Component":"Lesson Plan","Morning Circle / HR":"Le Panga match for G3","Art":"","EVLF":"","Design Lab":"","English":"Le Panga- Kabaddi Tournament","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"No lesson","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":21,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Mon, 9 Feb":{"lesson_plan":{"row_number":22,"Date":"Mon, 9 Feb","Component":"Lesson Plan","Morning Circle / HR":"G3 assembly presentation\nShort film on inventions for Science Month","Art":"","EVLF":"","Design Lab":"","English":"No Lesson","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme : Light\nResource : Science Textbook\n\nWU: Are you all stars? Give reason.\nML: \nPW: ","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":23,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Fri, 6 Feb":{"lesson_plan":{"row_number":25,"Date":"Fri, 6 Feb","Component":"Lesson Plan","Morning Circle / HR":"Section-wise assembly","Art":"No Lesson","EVLF":"","Design Lab":"No Lesson","English":"Resource: English textbook and Notebook\nBring fevicol to paste SA4 papers in your notebook\n\nWarmUp: Distribution of SA-4 paper and pasting it in the notebook\nMain Lesson: Reading the playscript on page 88\nPractise Work: New words ","Creative Writing":"No lesson","Hindi":"S.A -4 Writing","Marathi\nResources Folder":"No Lesson","Numeracy\nG3 Resource folder":"WU:  Few questions on area, perimeter and units\nML & PW: Solve from tb pg no 168 Q1,2 and 3 in NB","Sports":"Kabaddi Match practice","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme : Light\nResource : Science Textbook\n\nWU: Are you all stars? Give reason.\nML: Establishing the relationship between celestial bodies in the solar system.(orbits, asteroids, moon, sun)\nPW: After reading page 110 (Our solar system), solve activity (1,2,3)\nPg 112 (Q 1,2,3)","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":26,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"Solve from tb pg no 170 Q4 and 5 in your NB. Submit on 10th Feb","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Solve : Pg, 112 (Q. 4,5,6) \nDue : Monday 09 Feb","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Thu, 5 Feb":{"lesson_plan":{"row_number":27,"Date":"Thu, 5 Feb","Component":"Lesson Plan","Morning Circle / HR":"Rehearsal for G3 assembly","Art":"No Lesson","EVLF":"","Design Lab":"No Lesson","English":"Resource: English textbook and Notebook\n\nWarmUp: Introduction to new unit\nMain Lesson: Discussion on different cultures\nPractise Work: What is that one thing you really like about the different cultures that you've been introduced to?","Creative Writing":"No lesson","Hindi":"S.A -4 Reading ","Marathi\nResources Folder":"No Lesson","Numeracy\nG3 Resource folder":"WU: SA 4 discussion \nML: Explaining area and perimeter and basic units. Reading vocabulary \nPW: Getting started","Sports":"No Lesson","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme: Earth and its habitat\nResource: Textbook needed\n\nWU: Discussion of WAH from last 2 lessons.\nML: What are the different types of habitat?\nHow are different animals suited to their habitats? (animals,plants)\nPW: Solving the questions of pg. 92( Q 1,2,3,4) & Pg. 95 (Q4 -a,b,c,d) & Habitats Worksheet","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":28,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Finish the worksheet.","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Wed, 4 Feb":{"lesson_plan":{"row_number":29,"Date":"Wed, 4 Feb","Component":"Lesson Plan","Morning Circle / HR":"Rehearsal for G3 assembly","Art":"- Introduce New Project \n- Saura painting","EVLF":"","Design Lab":"SA 4 - Learning fair project","English":"S.A. - 4","Creative Writing":"No lesson","Hindi":"S.A -4 Revision","Marathi\nResources Folder":"No Lesson","Numeracy\nG3 Resource folder":"WU: KBD of Area and perimeter\nML: Introduction of area and perimeter\nPW: Activity for area ( square paper will be given)","Sports":"Kabaddi Match practice","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme: Earth and its habitat\nResource: Textbook needed\n\nWU: https://www.youtube.com/watch?v=AuELkcg5A_c&t=30s (Evolution of Pakicetus)\nML: How are different animals suited to their habitats? (animals, birds)\nPW: Finding out the features of the animals based on their habitats - birds,fishes,tiger,kingfisher, Great Indian Bustard, Yellow crowned woodpecker, Hoopoe, Bonelli's eagle.","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":30,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Solve : from the science textbook - pg. 88(1,2,3,4) & pg. 90(Activity 1 - 1)","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Tue, 3 Feb":{"lesson_plan":{"row_number":31,"Date":"Tue, 3 Feb","Component":"Lesson Plan","Morning Circle / HR":"Rehearsal for G3 assembly","Art":"No Lesson","EVLF":"","Design Lab":"No Lesson","English":"Resources: Only notebook\n\nWarm-Up: Importance of putting the right punctuation and capital letters at the right place\nMain Lesson: Recalling CUPSS rule for punctuating and capitalising the words\nPractise Work: Revision of punctuating the paragraph for SA-4","Creative Writing":"No lesson","Hindi":"No Lesson","Marathi\nResources Folder":"WU: शुद्धलेखन \r\nML: ऐ आणि ओ चा अभ्यास \nPW: वाचन करणे ","Numeracy\nG3 Resource folder":"SA 4","Sports":"Kabaddi Match practice","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"No Lesson","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":32,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Mon, 2 Feb":{"lesson_plan":{"row_number":33,"Date":"Mon, 2 Feb","Component":"Lesson Plan","Morning Circle / HR":"Common assembly\nHR lesson: Rehearsal for G3 assembly","Art":"Free Drawing Session","EVLF":"","Design Lab":"No Lesson","English":"No lesson","Creative Writing":"Introduction to non-fiction: Autobiography writing","Hindi":"\nआरम्भ - \"कोयल पुस्तक \"से  \"आलस का फल\"  पाठ पर चर्चा  l \nमुख्य पाठ -पाठ का पठन  l\nअभ्यास कार्य - कठिन शब्दों का लेखन   l ","Marathi\nResources Folder":"SA 4 + मराठी दिवसाच्या कार्यक्रमाबद्दल बोलणे ","Numeracy\nG3 Resource folder":"No Lesson","Sports":"No Lesson","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme: Earth and its habitat\nResource: Textbook needed\n\nWU: Pg. 92 Questions about tiger.\nML: Stating the differences between habitat, ecosystem, environment.\nPW: Making a table for differences","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":34,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"WAH : CYP Question 4. \nDUE on 5th Feb.","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Fri, 30 Jan":{"lesson_plan":{"row_number":36,"Date":"Fri, 30 Jan","Component":"Lesson Plan","Morning Circle / HR":"Section-wise common circle","Art":"No Lesson","EVLF":"No Lesson","Design Lab":"No Lesson","English":"Mock Test Discussion and Doubt clarification","Creative Writing":"No Lesson","Hindi":"(कोई Textbook नहीं लानी है सिर्फ Notebook लेकर आना है l) \nआरम्भ -  संवाद लेखन पर  चर्चा  l \nमुख्य पाठ - संवाद का गतिविधि खेल    l\nअभ्यास कार्य -  संवाद लेखन का अभ्यास कार्य  l ","Marathi\nResources Folder":"No Lesson","Numeracy\nG3 Resource folder":"Revision of SA4 and Ex 13. 2 any doubts","Sports":"Warmup = information the cooking competition in trek lesson \nMain lesson = We will watch a video to see what food items we are going to prepare\nCloser = List of Items Required for Students","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Theme: Earth and its habitat\nResource: Textbook needed\n\nWU: Pg. 87 of science textbook - Getting started (1,2)\nML: Stating the differences between habitat, ecosystem, environment.\nWhat is a habitat? What are the different types of habitat?\nHow are different animals suited to their habitats? (animals, birds, plants)\nPW: Writing the answers.","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":37,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"WAH : Pg. 90 (Activity 1 : 1,2,3) Due on Monday 2nd Feb","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Thu, 29 Jan":{"lesson_plan":{"row_number":38,"Date":"Thu, 29 Jan","Component":"Lesson Plan","Morning Circle / HR":"Practice for assembly","Art":"No Lesson","EVLF":"\nML - Preparing grow bags in Garden for planting cucumbers.","Design Lab":"No Lesson","English":"Mock Test ","Creative Writing":"No Lesson","Hindi":"\nआरम्भ - \"कथा मंजूषा \"पुस्तक से \" पाठ -6 लालची कुत्ता पाठ की पुनरावृत्ति  l \nमुख्य पाठ -पाठ पर आधारित संवाद लेखन गतिविधि खेल    l\nअभ्यास कार्य - संवाद लेखन कार्य   l ","Marathi\nResources Folder":"No Lesson","Numeracy\nG3 Resource folder":"Revision of data and percentage","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"SA 4","PLEASE DO NOT REMOVE THIS COLUMN.":""},"wah":{"row_number":39,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Wed, 28 Jan":{"lesson_plan":{"row_number":40,"Date":"Wed, 28 Jan","Component":"Lesson Plan","Morning Circle / HR":"Practice for assembly","Art":"Reflections on Art fest and distribution of artwork ","EVLF":"No Lesson","Design Lab":"Integration with Thematics -  Experiments based on Light ( Reflection, Refraction and Illusion)","English":"Resources: only English notebook\n\nWarm-Up: Recalling the spelling rules and tricks done the previous day and WAH discussion\nMain Lesson: Punctuating the paragraph \nPractise work: Practising punctuating the paragraph","Creative Writing":"No Lesson","Hindi":"\nआरम्भ - \"कथा मंजूषा \"पुस्तक से \" पाठ -6 लालची कुत्ता पाठ की पुनरावृत्ति  l \nमुख्य पाठ -रचनात्मक लेखन पर चर्चा   l\nअभ्यास कार्य - रचनात्मक  लेखन  कार्य  l ","Marathi\nResources Folder":"No Lesson","Numeracy\nG3 Resource folder":"Revision of fractions ","Sports":"Tournament preparation \nWarmup =Review all skills \nMain lesson = Bonas, Raiding, Defending practice \nClosing = Group discussion","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"Revision for SA 4","PLEASE DO NOT REMOVE THIS COLUMN.":"\\"},"wah":{"row_number":41,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Fri, 30th May 25":{"wah":{"row_number":378,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}},"Thu, 29th May 25":{"wah":{"row_number":380,"Date":"","Component":"WAH","Morning Circle / HR":"","Art":"","EVLF":"","Design Lab":"","English":"","Creative Writing":"","Hindi":"","Marathi\nResources Folder":"","Numeracy\nG3 Resource folder":"","Sports":"","Thematics\n\nLESSON RESOURCES\n THEMATICS PROJECT \nANSWER KEY":"","PLEASE DO NOT REMOVE THIS COLUMN.":""}}};

(function () {
    const metaFields = new Set(['row_number', 'Date', 'Component']);
    const allSubjectSet = new Set();
    const intermediateDays = [];

    for (const [date, payload] of Object.entries(data)) {
        const lesson = payload.lesson_plan || null;
        const wah = payload.wah || null;

        const collectSubjects = (row) => {
            if (!row) return;
            for (const key of Object.keys(row)) {
                if (!metaFields.has(key)) {
                    allSubjectSet.add(key);
                }
            }
        };
        collectSubjects(lesson);
        collectSubjects(wah);

        intermediateDays.push({ date, lesson, wah });
    }

    const allSubjects = Array.from(allSubjectSet);
    const dayObjects = intermediateDays.map(buildDayObject);
    renderApp(dayObjects, allSubjects);

    function buildDayObject(entry) {
        const subjects = allSubjects.map(subjectName => {
            const lessonRaw = entry.lesson ? entry.lesson[subjectName] ?? '' : '';
            const wahRaw = entry.wah ? entry.wah[subjectName] ?? '' : '';
            return {
                name: subjectName,
                lesson: makeSection(lessonRaw),
                wah: makeSection(wahRaw)
            };
        });

        const aggregatedPieces = [entry.date];
        subjects.forEach(s => {
            aggregatedPieces.push(s.name, s.lesson.raw, s.wah.raw);
        });
        if (entry.lesson) {
            aggregatedPieces.push(...flattenRow(entry.lesson));
        }
        if (entry.wah) {
            aggregatedPieces.push(...flattenRow(entry.wah));
        }
        const aggregatedText = aggregatedPieces.join(' | ').toLowerCase();

        const hasLesson = subjects.some(s => s.lesson.hasContent);
        const hasWah = subjects.some(s => s.wah.hasContent);
        const hasNoLesson = subjects.some(s => s.lesson.hasNoLesson || s.wah.hasNoLesson);

        const rawRows = [];
        if (entry.lesson) rawRows.push({ label: entry.lesson.Component || 'Lesson Plan', data: entry.lesson });
        if (entry.wah) rawRows.push({ label: entry.wah.Component || 'WAH', data: entry.wah });

        return {
            date: entry.date,
            subjects,
            aggregatedText,
            hasLesson,
            hasWah,
            hasNoLesson,
            rawRows
        };
    }

    function flattenRow(row) {
        const pairs = [];
        for (const [key, value] of Object.entries(row)) {
            pairs.push(key, value);
        }
        return pairs;
    }

    function makeSection(rawValue) {
        const hasContent = rawValue !== undefined && rawValue !== null && String(rawValue).trim() !== '';
        const cleaned = hasContent ? sanitizeText(String(rawValue)) : '—';
        const hasNoLesson = hasContent && /no lesson/i.test(String(rawValue));
        return {
            raw: rawValue ?? '',
            display: cleaned,
            hasContent,
            hasNoLesson
        };
    }

    function sanitizeText(text) {
        const normalized = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
        return escapeHtml(normalized).replace(/\n/g, '<br>');
    }

    function escapeHtml(str) {
        return str.replace(/[&<>"']/g, function (char) {
            switch (char) {
                case '&': return '&amp;';
                case '<': return '&lt;';
                case '>': return '&gt;';
                case '"': return '&quot;';
                case "'": return '&#39;';
                default: return char;
            }
        });
    }

    function renderApp(days, subjects) {
        const totalDaysEl = document.getElementById('totalDays');
        const totalSubjectsEl = document.getElementById('totalSubjects');
        const totalCountEl = document.getElementById('totalCount');
        const visibleCountEl = document.getElementById('visibleCount');
        const subjectTagList = document.getElementById('subjectTagList');
        const subjectFiltersEl = document.getElementById('subjectFilters');
        const daysContainer = document.getElementById('daysContainer');
        const emptyState = document.getElementById('emptyState');

        totalDaysEl.textContent = days.length;
        totalSubjectsEl.textContent = subjects.length;
        totalCountEl.textContent = days.length;
        visibleCountEl.textContent = days.length;

        subjectTagList.innerHTML = '';
        subjects.forEach(sub => {
            const tag = document.createElement('span');
            tag.className = 'subject-tag';
            tag.innerHTML = escapeHtml(sub).replace(/\n/g, ' / ');
            subjectTagList.appendChild(tag);
        });

        const state = {
            searchTerm: '',
            onlyLesson: false,
            onlyWah: false,
            selectedSubjects: new Set()
        };

        const subjectCheckboxes = [];
        subjects.forEach((subject, index) => {
            const checkboxId = `subject-${index}`;
            const wrapper = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = subject;
            checkbox.id = checkboxId;
            const textSpan = document.createElement('span');
            textSpan.innerHTML = escapeHtml(subject).replace(/\n/g, '<br>');
            wrapper.appendChild(checkbox);
            wrapper.appendChild(textSpan);
            subjectFiltersEl.appendChild(wrapper);
            subjectCheckboxes.push({ checkbox, subject });

            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    state.selectedSubjects.add(subject);
                } else {
                    state.selectedSubjects.delete(subject);
                }
                applyFilters();
                updateSubjectVisibility();
            });
        });

        document.getElementById('clearSubjects').addEventListener('click', () => {
            subjectCheckboxes.forEach(({ checkbox }) => checkbox.checked = false);
            state.selectedSubjects.clear();
            applyFilters();
            updateSubjectVisibility();
        });

        const dayElements = [];

        daysContainer.innerHTML = '';
        days.forEach((day, idx) => {
            const detailsEl = document.createElement('details');
            detailsEl.className = 'day-card';
            if (idx === 0) detailsEl.open = true;
            detailsEl.dataset.searchText = day.aggregatedText;
            detailsEl.dataset.hasLesson = day.hasLesson ? 'true' : 'false';
            detailsEl.dataset.hasWah = day.hasWah ? 'true' : 'false';
            detailsEl.dataset.hasNoLesson = day.hasNoLesson ? 'true' : 'false';

            const summaryEl = document.createElement('summary');
            const summaryLeft = document.createElement('div');
            summaryLeft.className = 'summary-left';
            const titleEl = document.createElement('div');
            titleEl.className = 'day-title';
            titleEl.textContent = day.date;
            summaryLeft.appendChild(titleEl);

            const badgeRow = document.createElement('div');
            badgeRow.className = 'badge-row';
            const createBadge = (text, className) => {
                const badge = document.createElement('span');
                badge.className = `badge ${className}`;
                badge.textContent = text;
                return badge;
            };
            if (day.hasLesson) badgeRow.appendChild(createBadge('Lesson Plan', 'lesson'));
            if (day.hasWah) badgeRow.appendChild(createBadge('WAH', 'wah'));
            if (day.hasNoLesson) badgeRow.appendChild(createBadge('Contains “No Lesson”', 'warning'));
            if (!badgeRow.childElementCount) {
                badgeRow.appendChild(createBadge('No entries recorded', 'warning'));
            }
            summaryLeft.appendChild(badgeRow);

            const summaryRight = document.createElement('div');
            summaryRight.className = 'summary-right';
            summaryRight.innerHTML = 'Click to expand';

            summaryEl.appendChild(summaryLeft);
            summaryEl.appendChild(summaryRight);

            const dayContent = document.createElement('div');
            dayContent.className = 'day-content';

            const viewToggle = document.createElement('div');
            viewToggle.className = 'view-toggle';
            viewToggle.innerHTML = `
                <button type="button" class="active" data-view="structured">Structured view</button>
                <button type="button" data-view="raw">Raw data</button>
            `;
            dayContent.appendChild(viewToggle);

            const structuredView = document.createElement('div');
            structuredView.className = 'structured-view';
            const subjectGrid = document.createElement('div');
            subjectGrid.className = 'subject-grid';

            const subjectCardMap = new Map();

            day.subjects.forEach(subject => {
                const card = document.createElement('div');
                card.className = 'subject-card';
                card.dataset.subject = subject.name;

                const title = document.createElement('div');
                title.className = 'subject-title';
                title.innerHTML = escapeHtml(subject.name).replace(/\n/g, '<br>');
                card.appendChild(title);

                const lessonSection = document.createElement('div');
                lessonSection.className = 'subject-section lesson-plan-section';
                if (subject.lesson.hasNoLesson) lessonSection.classList.add('has-no-lesson');
                lessonSection.innerHTML = `
                    <div class="section-title">Lesson Plan</div>
                    <div class="section-body">${subject.lesson.display}</div>
                `;
                card.appendChild(lessonSection);

                const wahSection = document.createElement('div');
                wahSection.className = 'subject-section wah-section';
                if (subject.wah.hasNoLesson) wahSection.classList.add('has-no-lesson');
                wahSection.innerHTML = `
                    <div class="section-title">WAH (Work at Home)</div>
                    <div class="section-body">${subject.wah.display}</div>
                `;
                card.appendChild(wahSection);

                subjectGrid.appendChild(card);
                subjectCardMap.set(subject.name, card);
            });

            structuredView.appendChild(subjectGrid);
            dayContent.appendChild(structuredView);

            const rawView = document.createElement('div');
            rawView.className = 'raw-view hidden';
            rawView.appendChild(buildRawTable(day.rawRows));
            dayContent.appendChild(rawView);

            detailsEl.appendChild(summaryEl);
            detailsEl.appendChild(dayContent);
            daysContainer.appendChild(detailsEl);

            dayElements.push({
                element: detailsEl,
                data: day,
                subjectCardMap
            });
        });

        document.getElementById('searchInput').addEventListener('input', (event) => {
            state.searchTerm = event.target.value.trim().toLowerCase();
            applyFilters();
        });

        document.getElementById('filterLesson').addEventListener('change', (event) => {
            state.onlyLesson = event.target.checked;
            applyFilters();
        });

        document.getElementById('filterWah').addEventListener('change', (event) => {
            state.onlyWah = event.target.checked;
            applyFilters();
        });

        document.getElementById('expandAll').addEventListener('click', () => {
            dayElements.forEach(({ element }) => element.open = true);
        });

        document.getElementById('collapseAll').addEventListener('click', () => {
            dayElements.forEach(({ element }) => element.open = false);
        });

        daysContainer.addEventListener('click', (event) => {
            if (event.target.matches('.view-toggle button')) {
                const button = event.target;
                const view = button.dataset.view;
                const wrapper = button.closest('.day-content');
                const toggle = button.parentElement;
                toggle.querySelectorAll('button').forEach(btn => btn.classList.toggle('active', btn === button));
                wrapper.querySelector('.structured-view').classList.toggle('hidden', view !== 'structured');
                wrapper.querySelector('.raw-view').classList.toggle('hidden', view !== 'raw');
            }
        });

        applyFilters();
        updateSubjectVisibility();

        function applyFilters() {
            let visibleCount = 0;
            dayElements.forEach(({ element, data }) => {
                const matchesLesson = !state.onlyLesson || data.hasLesson;
                const matchesWah = !state.onlyWah || data.hasWah;
                const matchesSearch = !state.searchTerm || element.dataset.searchText.includes(state.searchTerm);
                const matchesSubjects = state.selectedSubjects.size === 0 ||
                    data.subjects.some(subject =>
                        state.selectedSubjects.has(subject.name) &&
                        (subject.lesson.hasContent || subject.wah.hasContent)
                    );

                const shouldShow = matchesLesson && matchesWah && matchesSearch && matchesSubjects;
                element.style.display = shouldShow ? '' : 'none';
                if (shouldShow) visibleCount++;
            });

            visibleCountEl.textContent = visibleCount;
            emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
        }

        function updateSubjectVisibility() {
            dayElements.forEach(({ subjectCardMap, data }) => {
                subjectCardMap.forEach((cardEl, subjectName) => {
                    const showAll = state.selectedSubjects.size === 0;
                    const isSelected = state.selectedSubjects.has(subjectName);
                    cardEl.style.display = (showAll || isSelected) ? '' : 'none';
                });
            });
        }

        function buildRawTable(rawRows) {
            const container = document.createElement('div');
            if (!rawRows.length) {
                container.innerHTML = '<p style="color:var(--muted);font-size:0.9rem;">No raw rows available.</p>';
                return container;
            }

            const columnsSet = new Set();
            rawRows.forEach(row => {
                Object.keys(row.data).forEach(key => columnsSet.add(key));
            });

            const priority = ['row_number', 'Date', 'Component'];
            const columns = Array.from(columnsSet).sort((a, b) => {
                const aPriority = priority.indexOf(a);
                const bPriority = priority.indexOf(b);
                if (aPriority !== -1 && bPriority !== -1) return aPriority - bPriority;
                if (aPriority !== -1) return -1;
                if (bPriority !== -1) return 1;
                return a.localeCompare(b);
            });

            const table = document.createElement('table');
            table.className = 'raw-table';

            const thead = document.createElement('thead');
            const headRow = document.createElement('tr');
            const sourceTh = document.createElement('th');
            sourceTh.textContent = 'Source';
            headRow.appendChild(sourceTh);
            columns.forEach(col => {
                const th = document.createElement('th');
                th.innerHTML = escapeHtml(col).replace(/\n/g, '<br>');
                th.title = col;
                headRow.appendChild(th);
            });
            thead.appendChild(headRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            rawRows.forEach(row => {
                const tr = document.createElement('tr');
                const sourceTd = document.createElement('td');
                sourceTd.textContent = row.label || '—';
                tr.appendChild(sourceTd);

                columns.forEach(col => {
                    const td = document.createElement('td');
                    const value = row.data[col];
                    if (value === undefined || value === null || String(value).trim() === '') {
                        td.textContent = '—';
                    } else {
                        const sanitized = sanitizeText(String(value));
                        const isNoLesson = /no lesson/i.test(String(value));
                        if (isNoLesson) td.classList.add('no-lesson');
                        td.innerHTML = sanitized;
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            container.appendChild(table);
            return container;
        }
    }
})();
</script>
</body>
</html>